"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports["default"] = exports.VXETablePluginExportXLSX = void 0;

var _xeUtils = _interopRequireDefault(require("xe-utils"));

var _exceljs = _interopRequireDefault(require("exceljs"));

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { "default": obj }; }

var vxetable;
var defaultHeaderBackgroundColor = 'f8f8f9';
var defaultCellFontColor = '606266';
var defaultCellBorderStyle = 'thin';
var defaultCellBorderColor = 'e8eaec';

function getCellLabel(column, cellValue) {
  if (cellValue) {
    if (column.type === 'seq') {
      return _xeUtils["default"].toValueString(cellValue);
    }

    switch (column.cellType) {
      case 'string':
        return _xeUtils["default"].toValueString(cellValue);

      case 'number':
        if (!isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;

      default:
        if (cellValue.length < 12 && !isNaN(cellValue)) {
          return Number(cellValue);
        }

        break;
    }
  }

  return cellValue;
}

function getFooterData(opts, footerData) {
  var footerFilterMethod = opts.footerFilterMethod;
  return footerFilterMethod ? footerData.filter(function (items, index) {
    return footerFilterMethod({
      items: items,
      $rowIndex: index
    });
  }) : footerData;
}

function getFooterCellValue($table, opts, rows, column) {
  var cellValue = getCellLabel(column, rows[$table.getVMColumnIndex(column)]);
  return cellValue;
}

function getValidColumn(column) {
  var childNodes = column.childNodes;
  var isColGroup = childNodes && childNodes.length;

  if (isColGroup) {
    return getValidColumn(childNodes[0]);
  }

  return column;
}

function setExcelRowHeight(excelRow, height) {
  if (height) {
    excelRow.height = _xeUtils["default"].floor(height * 0.75, 12);
  }
}

function setExcelCellStyle(excelCell, align) {
  excelCell.protection = {
    locked: false
  };
  excelCell.alignment = {
    vertical: 'middle',
    horizontal: align || 'left'
  };
}

function getDefaultBorderStyle() {
  return {
    top: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    left: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    bottom: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    },
    right: {
      style: defaultCellBorderStyle,
      color: {
        argb: defaultCellBorderColor
      }
    }
  };
}

function exportXLSX(params) {
  var msgKey = 'xlsx';
  var _vxetable = vxetable,
      modal = _vxetable.modal,
      t = _vxetable.t;
  var $table = params.$table,
      options = params.options,
      columns = params.columns,
      colgroups = params.colgroups,
      datas = params.datas;
  var props = $table.props,
      reactData = $table.reactData;
  var allHeaderAlign = props.headerAlign,
      allAlign = props.align,
      allFooterAlign = props.footerAlign;
  var rowHeight = reactData.rowHeight;
  var message = options.message,
      sheetName = options.sheetName,
      isHeader = options.isHeader,
      isFooter = options.isFooter,
      isMerge = options.isMerge,
      isColgroup = options.isColgroup,
      original = options.original,
      useStyle = options.useStyle,
      sheetMethod = options.sheetMethod;
  var showMsg = message !== false;
  var mergeCells = $table.getMergeCells();
  var colList = [];
  var footList = [];
  var sheetCols = [];
  var sheetMerges = [];
  var beforeRowCount = 0;
  var colHead = {};
  columns.forEach(function (column) {
    var id = column.id,
        field = column.field,
        renderWidth = column.renderWidth,
        headerExportMethod = column.headerExportMethod;
    colHead[id] = headerExportMethod ? headerExportMethod({
      column: column,
      $table: $table
    }) : original ? field : column.getTitle();
    sheetCols.push({
      key: id,
      width: _xeUtils["default"].ceil(renderWidth / 8, 1)
    });
  }); // 处理表头

  if (isHeader) {
    // 处理分组
    if (isColgroup && colgroups) {
      colgroups.forEach(function (cols, rIndex) {
        var groupHead = {};
        columns.forEach(function (column) {
          groupHead[column.id] = null;
        });
        cols.forEach(function (column) {
          var _colSpan = column._colSpan,
              _rowSpan = column._rowSpan,
              headerExportMethod = column.headerExportMethod;
          var validColumn = getValidColumn(column);
          var columnIndex = columns.indexOf(validColumn);
          groupHead[validColumn.id] = headerExportMethod ? headerExportMethod({
            column: column,
            $table: $table
          }) : original ? validColumn.field : column.getTitle();

          if (_colSpan > 1 || _rowSpan > 1) {
            sheetMerges.push({
              s: {
                r: rIndex,
                c: columnIndex
              },
              e: {
                r: rIndex + _rowSpan - 1,
                c: columnIndex + _colSpan - 1
              }
            });
          }
        });
        colList.push(groupHead);
      });
    } else {
      colList.push(colHead);
    }

    beforeRowCount += colList.length;
  } // 处理合并


  if (isMerge) {
    mergeCells.forEach(function (mergeItem) {
      var mergeRowIndex = mergeItem.row,
          mergeRowspan = mergeItem.rowspan,
          mergeColIndex = mergeItem.col,
          mergeColspan = mergeItem.colspan;
      sheetMerges.push({
        s: {
          r: mergeRowIndex + beforeRowCount,
          c: mergeColIndex
        },
        e: {
          r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
          c: mergeColIndex + mergeColspan - 1
        }
      });
    });
  }

  var rowList = datas.map(function (item) {
    var rest = {};
    columns.forEach(function (column) {
      rest[column.id] = getCellLabel(column, item[column.id]);
    });
    return rest;
  });
  beforeRowCount += rowList.length; // 处理表尾

  if (isFooter) {
    var _$table$getTableData = $table.getTableData(),
        footerData = _$table$getTableData.footerData;

    var footers = getFooterData(options, footerData);
    var mergeFooterItems = $table.getMergeFooterItems(); // 处理合并

    if (isMerge) {
      mergeFooterItems.forEach(function (mergeItem) {
        var mergeRowIndex = mergeItem.row,
            mergeRowspan = mergeItem.rowspan,
            mergeColIndex = mergeItem.col,
            mergeColspan = mergeItem.colspan;
        sheetMerges.push({
          s: {
            r: mergeRowIndex + beforeRowCount,
            c: mergeColIndex
          },
          e: {
            r: mergeRowIndex + beforeRowCount + mergeRowspan - 1,
            c: mergeColIndex + mergeColspan - 1
          }
        });
      });
    }

    footers.forEach(function (rows) {
      var item = {};
      columns.forEach(function (column) {
        item[column.id] = getFooterCellValue($table, options, rows, column);
      });
      footList.push(item);
    });
  }

  var exportMethod = function exportMethod() {
    var workbook = new _exceljs["default"].Workbook();
    var sheet = workbook.addWorksheet(sheetName);
    workbook.creator = 'vxe-table';
    sheet.columns = sheetCols;

    if (isHeader) {
      sheet.addRows(colList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);
          var headerAlign = column.headerAlign,
              align = column.align;
          setExcelCellStyle(excelCell, headerAlign || align || allHeaderAlign || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                bold: true,
                color: {
                  argb: defaultCellFontColor
                }
              },
              fill: {
                type: 'pattern',
                pattern: 'solid',
                fgColor: {
                  argb: defaultHeaderBackgroundColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        });
      });
    }

    sheet.addRows(rowList).forEach(function (excelRow) {
      if (useStyle) {
        setExcelRowHeight(excelRow, rowHeight);
      }

      excelRow.eachCell(function (excelCell) {
        var excelCol = sheet.getColumn(excelCell.col);
        var column = $table.getColumnById(excelCol.key);

        if (column) {
          var align = column.align;
          setExcelCellStyle(excelCell, align || allAlign);

          if (useStyle) {
            Object.assign(excelCell, {
              font: {
                color: {
                  argb: defaultCellFontColor
                }
              },
              border: getDefaultBorderStyle()
            });
          }
        }
      });
    });

    if (isFooter) {
      sheet.addRows(footList).forEach(function (excelRow) {
        if (useStyle) {
          setExcelRowHeight(excelRow, rowHeight);
        }

        excelRow.eachCell(function (excelCell) {
          var excelCol = sheet.getColumn(excelCell.col);
          var column = $table.getColumnById(excelCol.key);

          if (column) {
            var footerAlign = column.footerAlign,
                align = column.align;
            setExcelCellStyle(excelCell, footerAlign || align || allFooterAlign || allAlign);

            if (useStyle) {
              Object.assign(excelCell, {
                font: {
                  color: {
                    argb: defaultCellFontColor
                  }
                },
                border: getDefaultBorderStyle()
              });
            }
          }
        });
      });
    }

    if (useStyle && sheetMethod) {
      sheetMethod({
        options: options,
        workbook: workbook,
        worksheet: sheet,
        columns: columns,
        colgroups: colgroups,
        datas: datas,
        $table: $table
      });
    }

    sheetMerges.forEach(function (_ref) {
      var s = _ref.s,
          e = _ref.e;
      sheet.mergeCells(s.r + 1, s.c + 1, e.r + 1, e.c + 1);
    });
    workbook.xlsx.writeBuffer().then(function (buffer) {
      var blob = new Blob([buffer], {
        type: 'application/octet-stream'
      }); // 导出 xlsx

      downloadFile(params, blob, options);

      if (showMsg && modal) {
        modal.close(msgKey);
        modal.message({
          content: t('vxe.table.expSuccess'),
          status: 'success'
        });
      }
    });
  };

  if (showMsg && modal) {
    modal.message({
      id: msgKey,
      content: t('vxe.table.expLoading'),
      status: 'loading',
      duration: -1
    });
    setTimeout(exportMethod, 1500);
  } else {
    exportMethod();
  }
}

function downloadFile(params, blob, options) {
  var _vxetable2 = vxetable,
      modal = _vxetable2.modal,
      t = _vxetable2.t;
  var message = options.message,
      filename = options.filename,
      type = options.type;
  var showMsg = message !== false;

  if (window.Blob) {
    if (navigator.msSaveBlob) {
      navigator.msSaveBlob(blob, "".concat(filename, ".").concat(type));
    } else {
      var linkElem = document.createElement('a');
      linkElem.target = '_blank';
      linkElem.download = "".concat(filename, ".").concat(type);
      linkElem.href = URL.createObjectURL(blob);
      document.body.appendChild(linkElem);
      linkElem.click();
      document.body.removeChild(linkElem);
    }
  } else {
    if (showMsg && modal) {
      modal.alert({
        content: t('vxe.error.notExp'),
        status: 'error'
      });
    }
  }
}

function checkImportData(tableFields, fields) {
  return fields.some(function (field) {
    return tableFields.indexOf(field) > -1;
  });
}

function importError(params) {
  var _vxetable3 = vxetable,
      modal = _vxetable3.modal,
      t = _vxetable3.t;
  var $table = params.$table,
      options = params.options;
  var internalData = $table.internalData;
  var _importReject = internalData._importReject;
  var showMsg = options.message !== false;

  if (showMsg && modal) {
    modal.message({
      content: t('vxe.error.impFields'),
      status: 'error'
    });
  }

  if (_importReject) {
    _importReject({
      status: false
    });
  }
}

function importXLSX(params) {
  var _vxetable4 = vxetable,
      modal = _vxetable4.modal,
      t = _vxetable4.t;
  var $table = params.$table,
      columns = params.columns,
      options = params.options,
      file = params.file;
  var internalData = $table.internalData;
  var _importResolve = internalData._importResolve;
  var showMsg = options.message !== false;
  var fileReader = new FileReader();

  fileReader.onerror = function () {
    importError(params);
  };

  fileReader.onload = function (evnt) {
    var tableFields = [];
    columns.forEach(function (column) {
      var field = column.field;

      if (field) {
        tableFields.push(field);
      }
    });
    var workbook = new _exceljs["default"].Workbook();
    var readerTarget = evnt.target;

    if (readerTarget) {
      workbook.xlsx.load(readerTarget.result).then(function (wb) {
        var firstSheet = wb.worksheets[0];

        if (firstSheet) {
          var sheetValues = firstSheet.getSheetValues();

          var fieldIndex = _xeUtils["default"].findIndexOf(sheetValues, function (list) {
            return list && list.length > 0;
          });

          var fields = sheetValues[fieldIndex];
          var status = checkImportData(tableFields, fields);

          if (status) {
            var records = sheetValues.slice(fieldIndex).map(function (list) {
              var item = {};
              list.forEach(function (cellValue, cIndex) {
                item[fields[cIndex]] = cellValue;
              });
              var record = {};
              tableFields.forEach(function (field) {
                record[field] = _xeUtils["default"].isUndefined(item[field]) ? null : item[field];
              });
              return record;
            });
            $table.createData(records).then(function (data) {
              var loadRest;

              if (options.mode === 'insert') {
                loadRest = $table.insertAt(data, -1);
              } else {
                loadRest = $table.reloadData(data);
              }

              return loadRest.then(function () {
                if (_importResolve) {
                  _importResolve({
                    status: true
                  });
                }
              });
            });

            if (showMsg && modal) {
              modal.message({
                content: t('vxe.table.impSuccess', [records.length]),
                status: 'success'
              });
            }
          } else {
            importError(params);
          }
        } else {
          importError(params);
        }
      });
    } else {
      importError(params);
    }
  };

  fileReader.readAsArrayBuffer(file);
}

function handleImportEvent(params) {
  if (params.options.type === 'xlsx') {
    importXLSX(params);
    return false;
  }
}

function handleExportEvent(params) {
  if (params.options.type === 'xlsx') {
    exportXLSX(params);
    return false;
  }
}
/**
 * 基于 vxe-table 表格的增强插件，支持导出 xlsx 格式
 */


var VXETablePluginExportXLSX = {
  install: function install(vxetablecore) {
    var setup = vxetablecore.setup,
        interceptor = vxetablecore.interceptor;
    vxetable = vxetablecore;
    setup({
      "export": {
        types: {
          xlsx: 0
        }
      }
    });
    interceptor.mixin({
      'event.import': handleImportEvent,
      'event.export': handleExportEvent
    });
  }
};
exports.VXETablePluginExportXLSX = VXETablePluginExportXLSX;

if (typeof window !== 'undefined' && window.VXETable && window.VXETable.use) {
  window.VXETable.use(VXETablePluginExportXLSX);
}

var _default = VXETablePluginExportXLSX;
exports["default"] = _default;
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiaW5kZXguanMiXSwibmFtZXMiOlsidnhldGFibGUiLCJkZWZhdWx0SGVhZGVyQmFja2dyb3VuZENvbG9yIiwiZGVmYXVsdENlbGxGb250Q29sb3IiLCJkZWZhdWx0Q2VsbEJvcmRlclN0eWxlIiwiZGVmYXVsdENlbGxCb3JkZXJDb2xvciIsImdldENlbGxMYWJlbCIsImNvbHVtbiIsImNlbGxWYWx1ZSIsInR5cGUiLCJYRVV0aWxzIiwidG9WYWx1ZVN0cmluZyIsImNlbGxUeXBlIiwiaXNOYU4iLCJOdW1iZXIiLCJsZW5ndGgiLCJnZXRGb290ZXJEYXRhIiwib3B0cyIsImZvb3RlckRhdGEiLCJmb290ZXJGaWx0ZXJNZXRob2QiLCJmaWx0ZXIiLCJpdGVtcyIsImluZGV4IiwiJHJvd0luZGV4IiwiZ2V0Rm9vdGVyQ2VsbFZhbHVlIiwiJHRhYmxlIiwicm93cyIsImdldFZNQ29sdW1uSW5kZXgiLCJnZXRWYWxpZENvbHVtbiIsImNoaWxkTm9kZXMiLCJpc0NvbEdyb3VwIiwic2V0RXhjZWxSb3dIZWlnaHQiLCJleGNlbFJvdyIsImhlaWdodCIsImZsb29yIiwic2V0RXhjZWxDZWxsU3R5bGUiLCJleGNlbENlbGwiLCJhbGlnbiIsInByb3RlY3Rpb24iLCJsb2NrZWQiLCJhbGlnbm1lbnQiLCJ2ZXJ0aWNhbCIsImhvcml6b250YWwiLCJnZXREZWZhdWx0Qm9yZGVyU3R5bGUiLCJ0b3AiLCJzdHlsZSIsImNvbG9yIiwiYXJnYiIsImxlZnQiLCJib3R0b20iLCJyaWdodCIsImV4cG9ydFhMU1giLCJwYXJhbXMiLCJtc2dLZXkiLCJtb2RhbCIsInQiLCJvcHRpb25zIiwiY29sdW1ucyIsImNvbGdyb3VwcyIsImRhdGFzIiwicHJvcHMiLCJyZWFjdERhdGEiLCJhbGxIZWFkZXJBbGlnbiIsImhlYWRlckFsaWduIiwiYWxsQWxpZ24iLCJhbGxGb290ZXJBbGlnbiIsImZvb3RlckFsaWduIiwicm93SGVpZ2h0IiwibWVzc2FnZSIsInNoZWV0TmFtZSIsImlzSGVhZGVyIiwiaXNGb290ZXIiLCJpc01lcmdlIiwiaXNDb2xncm91cCIsIm9yaWdpbmFsIiwidXNlU3R5bGUiLCJzaGVldE1ldGhvZCIsInNob3dNc2ciLCJtZXJnZUNlbGxzIiwiZ2V0TWVyZ2VDZWxscyIsImNvbExpc3QiLCJmb290TGlzdCIsInNoZWV0Q29scyIsInNoZWV0TWVyZ2VzIiwiYmVmb3JlUm93Q291bnQiLCJjb2xIZWFkIiwiZm9yRWFjaCIsImlkIiwiZmllbGQiLCJyZW5kZXJXaWR0aCIsImhlYWRlckV4cG9ydE1ldGhvZCIsImdldFRpdGxlIiwicHVzaCIsImtleSIsIndpZHRoIiwiY2VpbCIsImNvbHMiLCJySW5kZXgiLCJncm91cEhlYWQiLCJfY29sU3BhbiIsIl9yb3dTcGFuIiwidmFsaWRDb2x1bW4iLCJjb2x1bW5JbmRleCIsImluZGV4T2YiLCJzIiwiciIsImMiLCJlIiwibWVyZ2VJdGVtIiwibWVyZ2VSb3dJbmRleCIsInJvdyIsIm1lcmdlUm93c3BhbiIsInJvd3NwYW4iLCJtZXJnZUNvbEluZGV4IiwiY29sIiwibWVyZ2VDb2xzcGFuIiwiY29sc3BhbiIsInJvd0xpc3QiLCJtYXAiLCJpdGVtIiwicmVzdCIsImdldFRhYmxlRGF0YSIsImZvb3RlcnMiLCJtZXJnZUZvb3Rlckl0ZW1zIiwiZ2V0TWVyZ2VGb290ZXJJdGVtcyIsImV4cG9ydE1ldGhvZCIsIndvcmtib29rIiwiRXhjZWxKUyIsIldvcmtib29rIiwic2hlZXQiLCJhZGRXb3Jrc2hlZXQiLCJjcmVhdG9yIiwiYWRkUm93cyIsImVhY2hDZWxsIiwiZXhjZWxDb2wiLCJnZXRDb2x1bW4iLCJnZXRDb2x1bW5CeUlkIiwiT2JqZWN0IiwiYXNzaWduIiwiZm9udCIsImJvbGQiLCJmaWxsIiwicGF0dGVybiIsImZnQ29sb3IiLCJib3JkZXIiLCJ3b3Jrc2hlZXQiLCJ4bHN4Iiwid3JpdGVCdWZmZXIiLCJ0aGVuIiwiYnVmZmVyIiwiYmxvYiIsIkJsb2IiLCJkb3dubG9hZEZpbGUiLCJjbG9zZSIsImNvbnRlbnQiLCJzdGF0dXMiLCJkdXJhdGlvbiIsInNldFRpbWVvdXQiLCJmaWxlbmFtZSIsIndpbmRvdyIsIm5hdmlnYXRvciIsIm1zU2F2ZUJsb2IiLCJsaW5rRWxlbSIsImRvY3VtZW50IiwiY3JlYXRlRWxlbWVudCIsInRhcmdldCIsImRvd25sb2FkIiwiaHJlZiIsIlVSTCIsImNyZWF0ZU9iamVjdFVSTCIsImJvZHkiLCJhcHBlbmRDaGlsZCIsImNsaWNrIiwicmVtb3ZlQ2hpbGQiLCJhbGVydCIsImNoZWNrSW1wb3J0RGF0YSIsInRhYmxlRmllbGRzIiwiZmllbGRzIiwic29tZSIsImltcG9ydEVycm9yIiwiaW50ZXJuYWxEYXRhIiwiX2ltcG9ydFJlamVjdCIsImltcG9ydFhMU1giLCJmaWxlIiwiX2ltcG9ydFJlc29sdmUiLCJmaWxlUmVhZGVyIiwiRmlsZVJlYWRlciIsIm9uZXJyb3IiLCJvbmxvYWQiLCJldm50IiwicmVhZGVyVGFyZ2V0IiwibG9hZCIsInJlc3VsdCIsIndiIiwiZmlyc3RTaGVldCIsIndvcmtzaGVldHMiLCJzaGVldFZhbHVlcyIsImdldFNoZWV0VmFsdWVzIiwiZmllbGRJbmRleCIsImZpbmRJbmRleE9mIiwibGlzdCIsInJlY29yZHMiLCJzbGljZSIsImNJbmRleCIsInJlY29yZCIsImlzVW5kZWZpbmVkIiwiY3JlYXRlRGF0YSIsImRhdGEiLCJsb2FkUmVzdCIsIm1vZGUiLCJpbnNlcnRBdCIsInJlbG9hZERhdGEiLCJyZWFkQXNBcnJheUJ1ZmZlciIsImhhbmRsZUltcG9ydEV2ZW50IiwiaGFuZGxlRXhwb3J0RXZlbnQiLCJWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1giLCJpbnN0YWxsIiwidnhldGFibGVjb3JlIiwic2V0dXAiLCJpbnRlcmNlcHRvciIsInR5cGVzIiwibWl4aW4iLCJWWEVUYWJsZSIsInVzZSJdLCJtYXBwaW5ncyI6Ijs7Ozs7OztBQUFBOztBQUVBOzs7O0FBRUEsSUFBSUEsUUFBSjtBQWlCQSxJQUFNQyw0QkFBNEIsR0FBRyxRQUFyQztBQUNBLElBQU1D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QVUsQ0FBQ0MsTUFBRCxDQUFWO0lBQ0EsT0FBTyxLQUFQO0VBQ0Q7QUFDRjtBQUVEO0FDeEJBO0FBQ0E7OztBRDBCTyxJQUFNbUssd0JBQXdCLEdBQUc7RUFDdENDLE9BRHNDLG1CQUM3QkMsWUFENkIsRUFDSDtJQUNqQyxJQUFRQyxLQUFSLEdBQStCRCxZQUEvQixDQUFRQyxLQUFSO0lBQUEsSUFBZUMsV0FBZixHQUErQkYsWUFBL0IsQ0FBZUUsV0FBZjtJQUVBMU4sUUFBUSxHQUFHd04sWUFBWDtJQUVBQyxLQUFLLENBQUM7TUFDSixVQUFRO1FBQ05FLEtBQUssRUFBRTtVQUNMMUUsSUFBSSxFQUFFO1FBREQ7TUFERDtJQURKLENBQUQsQ0FBTDtJQU9BeUUsV0FBVyxDQUFDRSxLQUFaLENBQWtCO01BQ2hCLGdCQUFnQlIsaUJBREE7TUFFaEIsZ0JBQWdCQztJQUZBLENBQWxCO0VBSUQ7QUFqQnFDLENBQWpDOzs7QUFvQlAsSUFBSSxPQUFPdkQsTUFBUCxLQUFrQixXQUFsQixJQUFpQ0EsTUFBTSxDQUFDK0QsUUFBeEMsSUFBb0QvRCxNQUFNLENBQUMrRCxRQUFQLENBQWdCQyxHQUF4RSxFQUE2RTtFQUMzRWhFLE1BQU0sQ0FBQytELFFBQVAsQ0FBZ0JDLEdBQWhCLENBQW9CUix3QkFBcEI7QUFDRDs7ZUFFY0Esd0IiLCJmaWxlIjoiaW5kZXguY29tbW9uLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IFhFVXRpbHMgZnJvbSAneGUtdXRpbHMnXHJcbmltcG9ydCB7IFZYRVRhYmxlQ29yZSwgVnhlVGFibGVDb25zdHJ1Y3RvciwgVnhlVGFibGVQcm9wVHlwZXMsIFZ4ZVRhYmxlRGVmaW5lcywgVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzIH0gZnJvbSAndnhlLXRhYmxlJ1xyXG5pbXBvcnQgRXhjZWxKUyBmcm9tICdleGNlbGpzJ1xyXG5cclxubGV0IHZ4ZXRhYmxlOlZYRVRhYmxlQ29yZVxyXG5cclxuZGVjbGFyZSBtb2R1bGUgJ3Z4ZS10YWJsZScge1xyXG4gIG5hbWVzcGFjZSBWeGVUYWJsZURlZmluZXMge1xyXG4gICAgaW50ZXJmYWNlIEV4dG9ydFNoZWV0TWV0aG9kUGFyYW1zIHtcclxuICAgICAgd29ya2Jvb2s6IEV4Y2VsSlMuV29ya2Jvb2s7XHJcbiAgICAgIHdvcmtzaGVldDogRXhjZWxKUy5Xb3Jrc2hlZXQ7XHJcbiAgICB9XHJcbiAgICBpbnRlcmZhY2UgQ29sdW1uSW5mbyB7XHJcbiAgICAgIF9yb3c6IGFueTtcclxuICAgICAgX2NvbFNwYW46IG51bWJlcjtcclxuICAgICAgX3Jvd1NwYW46IG51bWJlcjtcclxuICAgICAgY2hpbGROb2RlczogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm9bXTtcclxuICAgIH1cclxuICB9XHJcbn1cclxuXHJcbmNvbnN0IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3IgPSAnZjhmOGY5J1xyXG5jb25zdCBkZWZhdWx0Q2VsbEZvbnRDb2xvciA9ICc2MDYyNjYnXHJcbmNvbnN0IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUgPSAndGhpbidcclxuY29uc3QgZGVmYXVsdENlbGxCb3JkZXJDb2xvciA9ICdlOGVhZWMnXHJcblxyXG5mdW5jdGlvbiBnZXRDZWxsTGFiZWwgKGNvbHVtbjogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8sIGNlbGxWYWx1ZTogYW55KSB7XHJcbiAgaWYgKGNlbGxWYWx1ZSkge1xyXG4gICAgaWYgKGNvbHVtbi50eXBlID09PSAnc2VxJykge1xyXG4gICAgICByZXR1cm4gWEVVdGlscy50b1ZhbHVlU3RyaW5nKGNlbGxWYWx1ZSlcclxuICAgIH1cclxuICAgIHN3aXRjaCAoY29sdW1uLmNlbGxUeXBlKSB7XHJcbiAgICAgIGNhc2UgJ3N0cmluZyc6XHJcbiAgICAgICAgcmV0dXJuIFhFVXRpbHMudG9WYWx1ZVN0cmluZyhjZWxsVmFsdWUpXHJcbiAgICAgIGNhc2UgJ251bWJlcic6XHJcbiAgICAgICAgaWYgKCFpc05hTihjZWxsVmFsdWUpKSB7XHJcbiAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSlcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWtcclxuICAgICAgZGVmYXVsdDpcclxuICAgICAgICBpZiAoY2VsbFZhbHVlLmxlbmd0aCA8IDEyICYmICFpc05hTihjZWxsVmFsdWUpKSB7XHJcbiAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSlcclxuICAgICAgICB9XHJcbiAgICAgICAgYnJlYWtcclxuICAgIH1cclxuICB9XHJcbiAgcmV0dXJuIGNlbGxWYWx1ZVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXRGb290ZXJEYXRhIChvcHRzOiBWeGVUYWJsZVByb3BUeXBlcy5FeHBvcnRDb25maWcsIGZvb3RlckRhdGE6IGFueVtdW10pIHtcclxuICBjb25zdCB7IGZvb3RlckZpbHRlck1ldGhvZCB9ID0gb3B0c1xyXG4gIHJldHVybiBmb290ZXJGaWx0ZXJNZXRob2QgPyBmb290ZXJEYXRhLmZpbHRlcigoaXRlbXMsIGluZGV4KSA9PiBmb290ZXJGaWx0ZXJNZXRob2QoeyBpdGVtcywgJHJvd0luZGV4OiBpbmRleCB9KSkgOiBmb290ZXJEYXRhXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldEZvb3RlckNlbGxWYWx1ZSAoJHRhYmxlOiBWeGVUYWJsZUNvbnN0cnVjdG9yLCBvcHRzOiBWeGVUYWJsZVByb3BUeXBlcy5FeHBvcnRDb25maWcsIHJvd3M6IGFueVtdLCBjb2x1bW46IFZ4ZVRhYmxlRGVmaW5lcy5Db2x1bW5JbmZvKSB7XHJcbiAgY29uc3QgY2VsbFZhbHVlID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgcm93c1skdGFibGUuZ2V0Vk1Db2x1bW5JbmRleChjb2x1bW4pXSlcclxuICByZXR1cm4gY2VsbFZhbHVlXHJcbn1cclxuXHJcbmZ1bmN0aW9uIGdldFZhbGlkQ29sdW1uIChjb2x1bW46IFZ4ZVRhYmxlRGVmaW5lcy5Db2x1bW5JbmZvKTogVnhlVGFibGVEZWZpbmVzLkNvbHVtbkluZm8ge1xyXG4gIGNvbnN0IHsgY2hpbGROb2RlcyB9ID0gY29sdW1uXHJcbiAgY29uc3QgaXNDb2xHcm91cCA9IGNoaWxkTm9kZXMgJiYgY2hpbGROb2Rlcy5sZW5ndGhcclxuICBpZiAoaXNDb2xHcm91cCkge1xyXG4gICAgcmV0dXJuIGdldFZhbGlkQ29sdW1uKGNoaWxkTm9kZXNbMF0pXHJcbiAgfVxyXG4gIHJldHVybiBjb2x1bW5cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0RXhjZWxSb3dIZWlnaHQgKGV4Y2VsUm93OiBFeGNlbEpTLlJvdywgaGVpZ2h0OiBudW1iZXIpIHtcclxuICBpZiAoaGVpZ2h0KSB7XHJcbiAgICBleGNlbFJvdy5oZWlnaHQgPSBYRVV0aWxzLmZsb29yKGhlaWdodCAqIDAuNzUsIDEyKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gc2V0RXhjZWxDZWxsU3R5bGUgKGV4Y2VsQ2VsbDogRXhjZWxKUy5DZWxsLCBhbGlnbj86IFZ4ZVRhYmxlUHJvcFR5cGVzLkFsaWduIHwgVnhlVGFibGVQcm9wVHlwZXMuSGVhZGVyQWxpZ24gfCBWeGVUYWJsZVByb3BUeXBlcy5Gb290ZXJBbGlnbikge1xyXG4gIGV4Y2VsQ2VsbC5wcm90ZWN0aW9uID0ge1xyXG4gICAgbG9ja2VkOiBmYWxzZVxyXG4gIH1cclxuICBleGNlbENlbGwuYWxpZ25tZW50ID0ge1xyXG4gICAgdmVydGljYWw6ICdtaWRkbGUnLFxyXG4gICAgaG9yaXpvbnRhbDogYWxpZ24gfHwgJ2xlZnQnXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUgKCkge1xyXG4gIHJldHVybiB7XHJcbiAgICB0b3A6IHtcclxuICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXHJcbiAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgbGVmdDoge1xyXG4gICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcclxuICAgICAgY29sb3I6IHtcclxuICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yXHJcbiAgICAgIH1cclxuICAgIH0sXHJcbiAgICBib3R0b206IHtcclxuICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXHJcbiAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxyXG4gICAgICB9XHJcbiAgICB9LFxyXG4gICAgcmlnaHQ6IHtcclxuICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXHJcbiAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxyXG4gICAgICB9XHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBleHBvcnRYTFNYIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckV4cG9ydFBhcmFtcykge1xyXG4gIGNvbnN0IG1zZ0tleSA9ICd4bHN4J1xyXG4gIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlXHJcbiAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMsIGNvbHVtbnMsIGNvbGdyb3VwcywgZGF0YXMgfSA9IHBhcmFtc1xyXG4gIGNvbnN0IHsgcHJvcHMsIHJlYWN0RGF0YSB9ID0gJHRhYmxlXHJcbiAgY29uc3QgeyBoZWFkZXJBbGlnbjogYWxsSGVhZGVyQWxpZ24sIGFsaWduOiBhbGxBbGlnbiwgZm9vdGVyQWxpZ246IGFsbEZvb3RlckFsaWduIH0gPSBwcm9wc1xyXG4gIGNvbnN0IHsgcm93SGVpZ2h0IH0gPSByZWFjdERhdGFcclxuICBjb25zdCB7IG1lc3NhZ2UsIHNoZWV0TmFtZSwgaXNIZWFkZXIsIGlzRm9vdGVyLCBpc01lcmdlLCBpc0NvbGdyb3VwLCBvcmlnaW5hbCwgdXNlU3R5bGUsIHNoZWV0TWV0aG9kIH0gPSBvcHRpb25zXHJcbiAgY29uc3Qgc2hvd01zZyA9IG1lc3NhZ2UgIT09IGZhbHNlXHJcbiAgY29uc3QgbWVyZ2VDZWxscyA9ICR0YWJsZS5nZXRNZXJnZUNlbGxzKClcclxuICBjb25zdCBjb2xMaXN0OiBhbnlbXSA9IFtdXHJcbiAgY29uc3QgZm9vdExpc3Q6IGFueVtdID0gW11cclxuICBjb25zdCBzaGVldENvbHM6IGFueVtdID0gW11cclxuICBjb25zdCBzaGVldE1lcmdlczogeyBzOiB7IHI6IG51bWJlciwgYzogbnVtYmVyIH0sIGU6IHsgcjogbnVtYmVyLCBjOiBudW1iZXIgfSB9W10gPSBbXVxyXG4gIGxldCBiZWZvcmVSb3dDb3VudCA9IDBcclxuICBjb25zdCBjb2xIZWFkOiBhbnkgPSB7fVxyXG4gIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICBjb25zdCB7IGlkLCBmaWVsZCwgcmVuZGVyV2lkdGgsIGhlYWRlckV4cG9ydE1ldGhvZCB9ID0gY29sdW1uIGFzIGFueVxyXG4gICAgY29sSGVhZFtpZF0gPSBoZWFkZXJFeHBvcnRNZXRob2QgPyBoZWFkZXJFeHBvcnRNZXRob2QoeyBjb2x1bW4sICR0YWJsZSB9KSA6IChvcmlnaW5hbCA/IGZpZWxkIDogY29sdW1uLmdldFRpdGxlKCkpXHJcbiAgICBzaGVldENvbHMucHVzaCh7XHJcbiAgICAgIGtleTogaWQsXHJcbiAgICAgIHdpZHRoOiBYRVV0aWxzLmNlaWwocmVuZGVyV2lkdGggLyA4LCAxKVxyXG4gICAgfSlcclxuICB9KVxyXG4gIC8vIOWkhOeQhuihqOWktFxyXG4gIGlmIChpc0hlYWRlcikge1xyXG4gICAgLy8g5aSE55CG5YiG57uEXHJcbiAgICBpZiAoaXNDb2xncm91cCAmJiBjb2xncm91cHMpIHtcclxuICAgICAgY29sZ3JvdXBzLmZvckVhY2goKGNvbHMsIHJJbmRleCkgPT4ge1xyXG4gICAgICAgIGNvbnN0IGdyb3VwSGVhZDogYW55ID0ge31cclxuICAgICAgICBjb2x1bW5zLmZvckVhY2goKGNvbHVtbikgPT4ge1xyXG4gICAgICAgICAgZ3JvdXBIZWFkW2NvbHVtbi5pZF0gPSBudWxsXHJcbiAgICAgICAgfSlcclxuICAgICAgICBjb2xzLmZvckVhY2goKGNvbHVtbikgPT4ge1xyXG4gICAgICAgICAgY29uc3QgeyBfY29sU3BhbiwgX3Jvd1NwYW4sIGhlYWRlckV4cG9ydE1ldGhvZCB9ID0gY29sdW1uIGFzIGFueVxyXG4gICAgICAgICAgY29uc3QgdmFsaWRDb2x1bW4gPSBnZXRWYWxpZENvbHVtbihjb2x1bW4pXHJcbiAgICAgICAgICBjb25zdCBjb2x1bW5JbmRleCA9IGNvbHVtbnMuaW5kZXhPZih2YWxpZENvbHVtbilcclxuICAgICAgICAgIGdyb3VwSGVhZFt2YWxpZENvbHVtbi5pZF0gPSBoZWFkZXJFeHBvcnRNZXRob2QgPyBoZWFkZXJFeHBvcnRNZXRob2QoeyBjb2x1bW4sICR0YWJsZSB9KSA6IChvcmlnaW5hbCA/IHZhbGlkQ29sdW1uLmZpZWxkIDogY29sdW1uLmdldFRpdGxlKCkpXHJcbiAgICAgICAgICBpZiAoX2NvbFNwYW4gPiAxIHx8IF9yb3dTcGFuID4gMSkge1xyXG4gICAgICAgICAgICBzaGVldE1lcmdlcy5wdXNoKHtcclxuICAgICAgICAgICAgICBzOiB7IHI6IHJJbmRleCwgYzogY29sdW1uSW5kZXggfSxcclxuICAgICAgICAgICAgICBlOiB7IHI6IHJJbmRleCArIF9yb3dTcGFuIC0gMSwgYzogY29sdW1uSW5kZXggKyBfY29sU3BhbiAtIDEgfVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgICAgY29sTGlzdC5wdXNoKGdyb3VwSGVhZClcclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGNvbExpc3QucHVzaChjb2xIZWFkKVxyXG4gICAgfVxyXG4gICAgYmVmb3JlUm93Q291bnQgKz0gY29sTGlzdC5sZW5ndGhcclxuICB9XHJcbiAgLy8g5aSE55CG5ZCI5bm2XHJcbiAgaWYgKGlzTWVyZ2UpIHtcclxuICAgIG1lcmdlQ2VsbHMuZm9yRWFjaChtZXJnZUl0ZW0gPT4ge1xyXG4gICAgICBjb25zdCB7IHJvdzogbWVyZ2VSb3dJbmRleCwgcm93c3BhbjogbWVyZ2VSb3dzcGFuLCBjb2w6IG1lcmdlQ29sSW5kZXgsIGNvbHNwYW46IG1lcmdlQ29sc3BhbiB9ID0gbWVyZ2VJdGVtXHJcbiAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xyXG4gICAgICAgIHM6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50LCBjOiBtZXJnZUNvbEluZGV4IH0sXHJcbiAgICAgICAgZTogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQgKyBtZXJnZVJvd3NwYW4gLSAxLCBjOiBtZXJnZUNvbEluZGV4ICsgbWVyZ2VDb2xzcGFuIC0gMSB9XHJcbiAgICAgIH0pXHJcbiAgICB9KVxyXG4gIH1cclxuICBjb25zdCByb3dMaXN0ID0gZGF0YXMubWFwKGl0ZW0gPT4ge1xyXG4gICAgY29uc3QgcmVzdDogYW55ID0ge31cclxuICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XHJcbiAgICAgIHJlc3RbY29sdW1uLmlkXSA9IGdldENlbGxMYWJlbChjb2x1bW4sIGl0ZW1bY29sdW1uLmlkXSlcclxuICAgIH0pXHJcbiAgICByZXR1cm4gcmVzdFxyXG4gIH0pXHJcbiAgYmVmb3JlUm93Q291bnQgKz0gcm93TGlzdC5sZW5ndGhcclxuICAvLyDlpITnkIbooajlsL5cclxuICBpZiAoaXNGb290ZXIpIHtcclxuICAgIGNvbnN0IHsgZm9vdGVyRGF0YSB9ID0gJHRhYmxlLmdldFRhYmxlRGF0YSgpXHJcbiAgICBjb25zdCBmb290ZXJzID0gZ2V0Rm9vdGVyRGF0YShvcHRpb25zLCBmb290ZXJEYXRhKVxyXG4gICAgY29uc3QgbWVyZ2VGb290ZXJJdGVtcyA9ICR0YWJsZS5nZXRNZXJnZUZvb3Rlckl0ZW1zKClcclxuICAgIC8vIOWkhOeQhuWQiOW5tlxyXG4gICAgaWYgKGlzTWVyZ2UpIHtcclxuICAgICAgbWVyZ2VGb290ZXJJdGVtcy5mb3JFYWNoKG1lcmdlSXRlbSA9PiB7XHJcbiAgICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbVxyXG4gICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xyXG4gICAgICAgICAgczogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQsIGM6IG1lcmdlQ29sSW5kZXggfSxcclxuICAgICAgICAgIGU6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50ICsgbWVyZ2VSb3dzcGFuIC0gMSwgYzogbWVyZ2VDb2xJbmRleCArIG1lcmdlQ29sc3BhbiAtIDEgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBmb290ZXJzLmZvckVhY2goKHJvd3MpID0+IHtcclxuICAgICAgY29uc3QgaXRlbTogYW55ID0ge31cclxuICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgICBpdGVtW2NvbHVtbi5pZF0gPSBnZXRGb290ZXJDZWxsVmFsdWUoJHRhYmxlLCBvcHRpb25zLCByb3dzLCBjb2x1bW4pXHJcbiAgICAgIH0pXHJcbiAgICAgIGZvb3RMaXN0LnB1c2goaXRlbSlcclxuICAgIH0pXHJcbiAgfVxyXG4gIGNvbnN0IGV4cG9ydE1ldGhvZCA9ICgpID0+IHtcclxuICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKVxyXG4gICAgY29uc3Qgc2hlZXQgPSB3b3JrYm9vay5hZGRXb3Jrc2hlZXQoc2hlZXROYW1lKVxyXG4gICAgd29ya2Jvb2suY3JlYXRvciA9ICd2eGUtdGFibGUnXHJcbiAgICBzaGVldC5jb2x1bW5zID0gc2hlZXRDb2xzXHJcbiAgICBpZiAoaXNIZWFkZXIpIHtcclxuICAgICAgc2hlZXQuYWRkUm93cyhjb2xMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxyXG4gICAgICAgICAgY29uc3QgY29sdW1uOiBhbnkgPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxyXG4gICAgICAgICAgY29uc3QgeyBoZWFkZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBoZWFkZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxIZWFkZXJBbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICAgIGJvbGQ6IHRydWUsXHJcbiAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgZmlsbDoge1xyXG4gICAgICAgICAgICAgICAgdHlwZTogJ3BhdHRlcm4nLFxyXG4gICAgICAgICAgICAgICAgcGF0dGVybjogJ3NvbGlkJyxcclxuICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcclxuICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvclxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBzaGVldC5hZGRSb3dzKHJvd0xpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xyXG4gICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KVxyXG4gICAgICB9XHJcbiAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbClcclxuICAgICAgICBjb25zdCBjb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkgYXMgc3RyaW5nKVxyXG4gICAgICAgIGlmIChjb2x1bW4pIHtcclxuICAgICAgICAgIGNvbnN0IHsgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbilcclxuICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xyXG4gICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgIGZvbnQ6IHtcclxuICAgICAgICAgICAgICAgIGNvbG9yOiB7XHJcbiAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgICB9KVxyXG4gICAgfSlcclxuICAgIGlmIChpc0Zvb3Rlcikge1xyXG4gICAgICBzaGVldC5hZGRSb3dzKGZvb3RMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcclxuICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCByb3dIZWlnaHQpXHJcbiAgICAgICAgfVxyXG4gICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XHJcbiAgICAgICAgICBjb25zdCBleGNlbENvbCA9IHNoZWV0LmdldENvbHVtbihleGNlbENlbGwuY29sKVxyXG4gICAgICAgICAgY29uc3QgY29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5IGFzIHN0cmluZylcclxuICAgICAgICAgIGlmIChjb2x1bW4pIHtcclxuICAgICAgICAgICAgY29uc3QgeyBmb290ZXJBbGlnbiwgYWxpZ24gfSA9IGNvbHVtblxyXG4gICAgICAgICAgICBzZXRFeGNlbENlbGxTdHlsZShleGNlbENlbGwsIGZvb3RlckFsaWduIHx8IGFsaWduIHx8IGFsbEZvb3RlckFsaWduIHx8IGFsbEFsaWduKVxyXG4gICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcclxuICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xyXG4gICAgICAgICAgICAgICAgZm9udDoge1xyXG4gICAgICAgICAgICAgICAgICBjb2xvcjoge1xyXG4gICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXHJcbiAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXHJcbiAgICAgICAgICAgICAgfSlcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICAgIH0pXHJcbiAgICB9XHJcbiAgICBpZiAodXNlU3R5bGUgJiYgc2hlZXRNZXRob2QpIHtcclxuICAgICAgc2hlZXRNZXRob2QoeyBvcHRpb25zOiBvcHRpb25zLCB3b3JrYm9vaywgd29ya3NoZWV0OiBzaGVldCwgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcywgJHRhYmxlIH0pXHJcbiAgICB9XHJcbiAgICBzaGVldE1lcmdlcy5mb3JFYWNoKCh7IHMsIGUgfSkgPT4ge1xyXG4gICAgICBzaGVldC5tZXJnZUNlbGxzKHMuciArIDEsIHMuYyArIDEsIGUuciArIDEsIGUuYyArIDEpXHJcbiAgICB9KVxyXG4gICAgd29ya2Jvb2sueGxzeC53cml0ZUJ1ZmZlcigpLnRoZW4oYnVmZmVyID0+IHtcclxuICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtidWZmZXJdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pXHJcbiAgICAgIC8vIOWvvOWHuiB4bHN4XHJcbiAgICAgIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpXHJcbiAgICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICAgICAgbW9kYWwuY2xvc2UobXNnS2V5KVxyXG4gICAgICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUudGFibGUuZXhwU3VjY2VzcycpLCBzdGF0dXM6ICdzdWNjZXNzJyB9KVxyXG4gICAgICB9XHJcbiAgICB9KVxyXG4gIH1cclxuICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xyXG4gICAgbW9kYWwubWVzc2FnZSh7IGlkOiBtc2dLZXksIGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5leHBMb2FkaW5nJyksIHN0YXR1czogJ2xvYWRpbmcnLCBkdXJhdGlvbjogLTEgfSlcclxuICAgIHNldFRpbWVvdXQoZXhwb3J0TWV0aG9kLCAxNTAwKVxyXG4gIH0gZWxzZSB7XHJcbiAgICBleHBvcnRNZXRob2QoKVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gZG93bmxvYWRGaWxlIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckV4cG9ydFBhcmFtcywgYmxvYjogQmxvYiwgb3B0aW9uczogVnhlVGFibGVQcm9wVHlwZXMuRXhwb3J0Q29uZmlnKSB7XHJcbiAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGVcclxuICBjb25zdCB7IG1lc3NhZ2UsIGZpbGVuYW1lLCB0eXBlIH0gPSBvcHRpb25zXHJcbiAgY29uc3Qgc2hvd01zZyA9IG1lc3NhZ2UgIT09IGZhbHNlXHJcbiAgaWYgKHdpbmRvdy5CbG9iKSB7XHJcbiAgICBpZiAoKG5hdmlnYXRvciBhcyBhbnkpLm1zU2F2ZUJsb2IpIHtcclxuICAgICAgKG5hdmlnYXRvciBhcyBhbnkpLm1zU2F2ZUJsb2IoYmxvYiwgYCR7ZmlsZW5hbWV9LiR7dHlwZX1gKVxyXG4gICAgfSBlbHNlIHtcclxuICAgICAgY29uc3QgbGlua0VsZW0gPSBkb2N1bWVudC5jcmVhdGVFbGVtZW50KCdhJylcclxuICAgICAgbGlua0VsZW0udGFyZ2V0ID0gJ19ibGFuaydcclxuICAgICAgbGlua0VsZW0uZG93bmxvYWQgPSBgJHtmaWxlbmFtZX0uJHt0eXBlfWBcclxuICAgICAgbGlua0VsZW0uaHJlZiA9IFVSTC5jcmVhdGVPYmplY3RVUkwoYmxvYilcclxuICAgICAgZG9jdW1lbnQuYm9keS5hcHBlbmRDaGlsZChsaW5rRWxlbSlcclxuICAgICAgbGlua0VsZW0uY2xpY2soKVxyXG4gICAgICBkb2N1bWVudC5ib2R5LnJlbW92ZUNoaWxkKGxpbmtFbGVtKVxyXG4gICAgfVxyXG4gIH0gZWxzZSB7XHJcbiAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xyXG4gICAgICBtb2RhbC5hbGVydCh7IGNvbnRlbnQ6IHQoJ3Z4ZS5lcnJvci5ub3RFeHAnKSwgc3RhdHVzOiAnZXJyb3InIH0pXHJcbiAgICB9XHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBjaGVja0ltcG9ydERhdGEgKHRhYmxlRmllbGRzOiBzdHJpbmdbXSwgZmllbGRzOiBzdHJpbmdbXSkge1xyXG4gIHJldHVybiBmaWVsZHMuc29tZShmaWVsZCA9PiB0YWJsZUZpZWxkcy5pbmRleE9mKGZpZWxkKSA+IC0xKVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbXBvcnRFcnJvciAocGFyYW1zOiBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMuSW50ZXJjZXB0b3JJbXBvcnRQYXJhbXMpIHtcclxuICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZVxyXG4gIGNvbnN0IHsgJHRhYmxlLCBvcHRpb25zIH0gPSBwYXJhbXNcclxuICBjb25zdCB7IGludGVybmFsRGF0YSB9ID0gJHRhYmxlXHJcbiAgY29uc3QgeyBfaW1wb3J0UmVqZWN0IH0gPSBpbnRlcm5hbERhdGFcclxuICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZVxyXG4gIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLmVycm9yLmltcEZpZWxkcycpLCBzdGF0dXM6ICdlcnJvcicgfSlcclxuICB9XHJcbiAgaWYgKF9pbXBvcnRSZWplY3QpIHtcclxuICAgIF9pbXBvcnRSZWplY3QoeyBzdGF0dXM6IGZhbHNlIH0pXHJcbiAgfVxyXG59XHJcblxyXG5mdW5jdGlvbiBpbXBvcnRYTFNYIChwYXJhbXM6IFZ4ZUdsb2JhbEludGVyY2VwdG9ySGFuZGxlcy5JbnRlcmNlcHRvckltcG9ydFBhcmFtcykge1xyXG4gIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlXHJcbiAgY29uc3QgeyAkdGFibGUsIGNvbHVtbnMsIG9wdGlvbnMsIGZpbGUgfSA9IHBhcmFtc1xyXG4gIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGVcclxuICBjb25zdCB7IF9pbXBvcnRSZXNvbHZlIH0gPSBpbnRlcm5hbERhdGFcclxuICBjb25zdCBzaG93TXNnID0gb3B0aW9ucy5tZXNzYWdlICE9PSBmYWxzZVxyXG4gIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpXHJcbiAgZmlsZVJlYWRlci5vbmVycm9yID0gKCkgPT4ge1xyXG4gICAgaW1wb3J0RXJyb3IocGFyYW1zKVxyXG4gIH1cclxuICBmaWxlUmVhZGVyLm9ubG9hZCA9IChldm50KSA9PiB7XHJcbiAgICBjb25zdCB0YWJsZUZpZWxkczogc3RyaW5nW10gPSBbXVxyXG4gICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcclxuICAgICAgY29uc3QgZmllbGQgPSBjb2x1bW4uZmllbGRcclxuICAgICAgaWYgKGZpZWxkKSB7XHJcbiAgICAgICAgdGFibGVGaWVsZHMucHVzaChmaWVsZClcclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIGNvbnN0IHdvcmtib29rID0gbmV3IEV4Y2VsSlMuV29ya2Jvb2soKVxyXG4gICAgY29uc3QgcmVhZGVyVGFyZ2V0ID0gZXZudC50YXJnZXRcclxuICAgIGlmIChyZWFkZXJUYXJnZXQpIHtcclxuICAgICAgd29ya2Jvb2sueGxzeC5sb2FkKHJlYWRlclRhcmdldC5yZXN1bHQgYXMgQXJyYXlCdWZmZXIpLnRoZW4od2IgPT4ge1xyXG4gICAgICAgIGNvbnN0IGZpcnN0U2hlZXQgPSB3Yi53b3Jrc2hlZXRzWzBdXHJcbiAgICAgICAgaWYgKGZpcnN0U2hlZXQpIHtcclxuICAgICAgICAgIGNvbnN0IHNoZWV0VmFsdWVzID0gZmlyc3RTaGVldC5nZXRTaGVldFZhbHVlcygpIGFzIHN0cmluZ1tdW11cclxuICAgICAgICAgIGNvbnN0IGZpZWxkSW5kZXggPSBYRVV0aWxzLmZpbmRJbmRleE9mKHNoZWV0VmFsdWVzLCAobGlzdCkgPT4gbGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApXHJcbiAgICAgICAgICBjb25zdCBmaWVsZHMgPSBzaGVldFZhbHVlc1tmaWVsZEluZGV4XSBhcyBzdHJpbmdbXVxyXG4gICAgICAgICAgY29uc3Qgc3RhdHVzID0gY2hlY2tJbXBvcnREYXRhKHRhYmxlRmllbGRzLCBmaWVsZHMpXHJcbiAgICAgICAgICBpZiAoc3RhdHVzKSB7XHJcbiAgICAgICAgICAgIGNvbnN0IHJlY29yZHMgPSBzaGVldFZhbHVlcy5zbGljZShmaWVsZEluZGV4KS5tYXAobGlzdCA9PiB7XHJcbiAgICAgICAgICAgICAgY29uc3QgaXRlbSA6IGFueSA9IHt9XHJcbiAgICAgICAgICAgICAgbGlzdC5mb3JFYWNoKChjZWxsVmFsdWUsIGNJbmRleCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgaXRlbVtmaWVsZHNbY0luZGV4XV0gPSBjZWxsVmFsdWVcclxuICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIGNvbnN0IHJlY29yZDogYW55ID0ge31cclxuICAgICAgICAgICAgICB0YWJsZUZpZWxkcy5mb3JFYWNoKGZpZWxkID0+IHtcclxuICAgICAgICAgICAgICAgIHJlY29yZFtmaWVsZF0gPSBYRVV0aWxzLmlzVW5kZWZpbmVkKGl0ZW1bZmllbGRdKSA/IG51bGwgOiBpdGVtW2ZpZWxkXVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZFxyXG4gICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAkdGFibGUuY3JlYXRlRGF0YShyZWNvcmRzKVxyXG4gICAgICAgICAgICAgIC50aGVuKChkYXRhOiBhbnlbXSkgPT4ge1xyXG4gICAgICAgICAgICAgICAgbGV0IGxvYWRSZXN0OiBQcm9taXNlPGFueT5cclxuICAgICAgICAgICAgICAgIGlmIChvcHRpb25zLm1vZGUgPT09ICdpbnNlcnQnKSB7XHJcbiAgICAgICAgICAgICAgICAgIGxvYWRSZXN0ID0gJHRhYmxlLmluc2VydEF0KGRhdGEsIC0xKVxyXG4gICAgICAgICAgICAgICAgfSBlbHNlIHtcclxuICAgICAgICAgICAgICAgICAgbG9hZFJlc3QgPSAkdGFibGUucmVsb2FkRGF0YShkYXRhKVxyXG4gICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgcmV0dXJuIGxvYWRSZXN0LnRoZW4oKCkgPT4ge1xyXG4gICAgICAgICAgICAgICAgICBpZiAoX2ltcG9ydFJlc29sdmUpIHtcclxuICAgICAgICAgICAgICAgICAgICBfaW1wb3J0UmVzb2x2ZSh7IHN0YXR1czogdHJ1ZSB9KVxyXG4gICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9KVxyXG4gICAgICAgICAgICAgIH0pXHJcbiAgICAgICAgICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XHJcbiAgICAgICAgICAgICAgbW9kYWwubWVzc2FnZSh7IGNvbnRlbnQ6IHQoJ3Z4ZS50YWJsZS5pbXBTdWNjZXNzJywgW3JlY29yZHMubGVuZ3RoXSksIHN0YXR1czogJ3N1Y2Nlc3MnIH0pXHJcbiAgICAgICAgICAgIH1cclxuICAgICAgICAgIH0gZWxzZSB7XHJcbiAgICAgICAgICAgIGltcG9ydEVycm9yKHBhcmFtcylcclxuICAgICAgICAgIH1cclxuICAgICAgICB9IGVsc2Uge1xyXG4gICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKVxyXG4gICAgICAgIH1cclxuICAgICAgfSlcclxuICAgIH0gZWxzZSB7XHJcbiAgICAgIGltcG9ydEVycm9yKHBhcmFtcylcclxuICAgIH1cclxuICB9XHJcbiAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKVxyXG59XHJcblxyXG5mdW5jdGlvbiBoYW5kbGVJbXBvcnRFdmVudCAocGFyYW1zOiBWeGVHbG9iYWxJbnRlcmNlcHRvckhhbmRsZXMuSW50ZXJjZXB0b3JJbXBvcnRQYXJhbXMpIHtcclxuICBpZiAocGFyYW1zLm9wdGlvbnMudHlwZSA9PT0gJ3hsc3gnKSB7XHJcbiAgICBpbXBvcnRYTFNYKHBhcmFtcylcclxuICAgIHJldHVybiBmYWxzZVxyXG4gIH1cclxufVxyXG5cclxuZnVuY3Rpb24gaGFuZGxlRXhwb3J0RXZlbnQgKHBhcmFtczogVnhlR2xvYmFsSW50ZXJjZXB0b3JIYW5kbGVzLkludGVyY2VwdG9yRXhwb3J0UGFyYW1zKSB7XHJcbiAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICd4bHN4Jykge1xyXG4gICAgZXhwb3J0WExTWChwYXJhbXMpXHJcbiAgICByZXR1cm4gZmFsc2VcclxuICB9XHJcbn1cclxuXHJcbi8qKlxyXG4gKiDln7rkuo4gdnhlLXRhYmxlIOihqOagvOeahOWinuW8uuaPkuS7tu+8jOaUr+aMgeWvvOWHuiB4bHN4IOagvOW8j1xyXG4gKi9cclxuZXhwb3J0IGNvbnN0IFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWCA9IHtcclxuICBpbnN0YWxsICh2eGV0YWJsZWNvcmU6IFZYRVRhYmxlQ29yZSkge1xyXG4gICAgY29uc3QgeyBzZXR1cCwgaW50ZXJjZXB0b3IgfSA9IHZ4ZXRhYmxlY29yZVxyXG5cclxuICAgIHZ4ZXRhYmxlID0gdnhldGFibGVjb3JlXHJcblxyXG4gICAgc2V0dXAoe1xyXG4gICAgICBleHBvcnQ6IHtcclxuICAgICAgICB0eXBlczoge1xyXG4gICAgICAgICAgeGxzeDogMFxyXG4gICAgICAgIH1cclxuICAgICAgfVxyXG4gICAgfSlcclxuICAgIGludGVyY2VwdG9yLm1peGluKHtcclxuICAgICAgJ2V2ZW50LmltcG9ydCc6IGhhbmRsZUltcG9ydEV2ZW50LFxyXG4gICAgICAnZXZlbnQuZXhwb3J0JzogaGFuZGxlRXhwb3J0RXZlbnRcclxuICAgIH0pXHJcbiAgfVxyXG59XHJcblxyXG5pZiAodHlwZW9mIHdpbmRvdyAhPT0gJ3VuZGVmaW5lZCcgJiYgd2luZG93LlZYRVRhYmxlICYmIHdpbmRvdy5WWEVUYWJsZS51c2UpIHtcclxuICB3aW5kb3cuVlhFVGFibGUudXNlKFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWClcclxufVxyXG5cclxuZXhwb3J0IGRlZmF1bHQgVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYXHJcbiIsImltcG9ydCBYRVV0aWxzIGZyb20gJ3hlLXV0aWxzJztcbmltcG9ydCBFeGNlbEpTIGZyb20gJ2V4Y2VsanMnO1xubGV0IHZ4ZXRhYmxlO1xuY29uc3QgZGVmYXVsdEhlYWRlckJhY2tncm91bmRDb2xvciA9ICdmOGY4ZjknO1xuY29uc3QgZGVmYXVsdENlbGxGb250Q29sb3IgPSAnNjA2MjY2JztcbmNvbnN0IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUgPSAndGhpbic7XG5jb25zdCBkZWZhdWx0Q2VsbEJvcmRlckNvbG9yID0gJ2U4ZWFlYyc7XG5mdW5jdGlvbiBnZXRDZWxsTGFiZWwoY29sdW1uLCBjZWxsVmFsdWUpIHtcbiAgICBpZiAoY2VsbFZhbHVlKSB7XG4gICAgICAgIGlmIChjb2x1bW4udHlwZSA9PT0gJ3NlcScpIHtcbiAgICAgICAgICAgIHJldHVybiBYRVV0aWxzLnRvVmFsdWVTdHJpbmcoY2VsbFZhbHVlKTtcbiAgICAgICAgfVxuICAgICAgICBzd2l0Y2ggKGNvbHVtbi5jZWxsVHlwZSkge1xuICAgICAgICAgICAgY2FzZSAnc3RyaW5nJzpcbiAgICAgICAgICAgICAgICByZXR1cm4gWEVVdGlscy50b1ZhbHVlU3RyaW5nKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICBjYXNlICdudW1iZXInOlxuICAgICAgICAgICAgICAgIGlmICghaXNOYU4oY2VsbFZhbHVlKSkge1xuICAgICAgICAgICAgICAgICAgICByZXR1cm4gTnVtYmVyKGNlbGxWYWx1ZSk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGJyZWFrO1xuICAgICAgICAgICAgZGVmYXVsdDpcbiAgICAgICAgICAgICAgICBpZiAoY2VsbFZhbHVlLmxlbmd0aCA8IDEyICYmICFpc05hTihjZWxsVmFsdWUpKSB7XG4gICAgICAgICAgICAgICAgICAgIHJldHVybiBOdW1iZXIoY2VsbFZhbHVlKTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgYnJlYWs7XG4gICAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIGNlbGxWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldEZvb3RlckRhdGEob3B0cywgZm9vdGVyRGF0YSkge1xuICAgIGNvbnN0IHsgZm9vdGVyRmlsdGVyTWV0aG9kIH0gPSBvcHRzO1xuICAgIHJldHVybiBmb290ZXJGaWx0ZXJNZXRob2QgPyBmb290ZXJEYXRhLmZpbHRlcigoaXRlbXMsIGluZGV4KSA9PiBmb290ZXJGaWx0ZXJNZXRob2QoeyBpdGVtcywgJHJvd0luZGV4OiBpbmRleCB9KSkgOiBmb290ZXJEYXRhO1xufVxuZnVuY3Rpb24gZ2V0Rm9vdGVyQ2VsbFZhbHVlKCR0YWJsZSwgb3B0cywgcm93cywgY29sdW1uKSB7XG4gICAgY29uc3QgY2VsbFZhbHVlID0gZ2V0Q2VsbExhYmVsKGNvbHVtbiwgcm93c1skdGFibGUuZ2V0Vk1Db2x1bW5JbmRleChjb2x1bW4pXSk7XG4gICAgcmV0dXJuIGNlbGxWYWx1ZTtcbn1cbmZ1bmN0aW9uIGdldFZhbGlkQ29sdW1uKGNvbHVtbikge1xuICAgIGNvbnN0IHsgY2hpbGROb2RlcyB9ID0gY29sdW1uO1xuICAgIGNvbnN0IGlzQ29sR3JvdXAgPSBjaGlsZE5vZGVzICYmIGNoaWxkTm9kZXMubGVuZ3RoO1xuICAgIGlmIChpc0NvbEdyb3VwKSB7XG4gICAgICAgIHJldHVybiBnZXRWYWxpZENvbHVtbihjaGlsZE5vZGVzWzBdKTtcbiAgICB9XG4gICAgcmV0dXJuIGNvbHVtbjtcbn1cbmZ1bmN0aW9uIHNldEV4Y2VsUm93SGVpZ2h0KGV4Y2VsUm93LCBoZWlnaHQpIHtcbiAgICBpZiAoaGVpZ2h0KSB7XG4gICAgICAgIGV4Y2VsUm93LmhlaWdodCA9IFhFVXRpbHMuZmxvb3IoaGVpZ2h0ICogMC43NSwgMTIpO1xuICAgIH1cbn1cbmZ1bmN0aW9uIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgYWxpZ24pIHtcbiAgICBleGNlbENlbGwucHJvdGVjdGlvbiA9IHtcbiAgICAgICAgbG9ja2VkOiBmYWxzZVxuICAgIH07XG4gICAgZXhjZWxDZWxsLmFsaWdubWVudCA9IHtcbiAgICAgICAgdmVydGljYWw6ICdtaWRkbGUnLFxuICAgICAgICBob3Jpem9udGFsOiBhbGlnbiB8fCAnbGVmdCdcbiAgICB9O1xufVxuZnVuY3Rpb24gZ2V0RGVmYXVsdEJvcmRlclN0eWxlKCkge1xuICAgIHJldHVybiB7XG4gICAgICAgIHRvcDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgbGVmdDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSxcbiAgICAgICAgYm90dG9tOiB7XG4gICAgICAgICAgICBzdHlsZTogZGVmYXVsdENlbGxCb3JkZXJTdHlsZSxcbiAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxCb3JkZXJDb2xvclxuICAgICAgICAgICAgfVxuICAgICAgICB9LFxuICAgICAgICByaWdodDoge1xuICAgICAgICAgICAgc3R5bGU6IGRlZmF1bHRDZWxsQm9yZGVyU3R5bGUsXG4gICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsQm9yZGVyQ29sb3JcbiAgICAgICAgICAgIH1cbiAgICAgICAgfVxuICAgIH07XG59XG5mdW5jdGlvbiBleHBvcnRYTFNYKHBhcmFtcykge1xuICAgIGNvbnN0IG1zZ0tleSA9ICd4bHN4JztcbiAgICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZTtcbiAgICBjb25zdCB7ICR0YWJsZSwgb3B0aW9ucywgY29sdW1ucywgY29sZ3JvdXBzLCBkYXRhcyB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHsgcHJvcHMsIHJlYWN0RGF0YSB9ID0gJHRhYmxlO1xuICAgIGNvbnN0IHsgaGVhZGVyQWxpZ246IGFsbEhlYWRlckFsaWduLCBhbGlnbjogYWxsQWxpZ24sIGZvb3RlckFsaWduOiBhbGxGb290ZXJBbGlnbiB9ID0gcHJvcHM7XG4gICAgY29uc3QgeyByb3dIZWlnaHQgfSA9IHJlYWN0RGF0YTtcbiAgICBjb25zdCB7IG1lc3NhZ2UsIHNoZWV0TmFtZSwgaXNIZWFkZXIsIGlzRm9vdGVyLCBpc01lcmdlLCBpc0NvbGdyb3VwLCBvcmlnaW5hbCwgdXNlU3R5bGUsIHNoZWV0TWV0aG9kIH0gPSBvcHRpb25zO1xuICAgIGNvbnN0IHNob3dNc2cgPSBtZXNzYWdlICE9PSBmYWxzZTtcbiAgICBjb25zdCBtZXJnZUNlbGxzID0gJHRhYmxlLmdldE1lcmdlQ2VsbHMoKTtcbiAgICBjb25zdCBjb2xMaXN0ID0gW107XG4gICAgY29uc3QgZm9vdExpc3QgPSBbXTtcbiAgICBjb25zdCBzaGVldENvbHMgPSBbXTtcbiAgICBjb25zdCBzaGVldE1lcmdlcyA9IFtdO1xuICAgIGxldCBiZWZvcmVSb3dDb3VudCA9IDA7XG4gICAgY29uc3QgY29sSGVhZCA9IHt9O1xuICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgIGNvbnN0IHsgaWQsIGZpZWxkLCByZW5kZXJXaWR0aCwgaGVhZGVyRXhwb3J0TWV0aG9kIH0gPSBjb2x1bW47XG4gICAgICAgIGNvbEhlYWRbaWRdID0gaGVhZGVyRXhwb3J0TWV0aG9kID8gaGVhZGVyRXhwb3J0TWV0aG9kKHsgY29sdW1uLCAkdGFibGUgfSkgOiAob3JpZ2luYWwgPyBmaWVsZCA6IGNvbHVtbi5nZXRUaXRsZSgpKTtcbiAgICAgICAgc2hlZXRDb2xzLnB1c2goe1xuICAgICAgICAgICAga2V5OiBpZCxcbiAgICAgICAgICAgIHdpZHRoOiBYRVV0aWxzLmNlaWwocmVuZGVyV2lkdGggLyA4LCAxKVxuICAgICAgICB9KTtcbiAgICB9KTtcbiAgICAvLyDlpITnkIbooajlpLRcbiAgICBpZiAoaXNIZWFkZXIpIHtcbiAgICAgICAgLy8g5aSE55CG5YiG57uEXG4gICAgICAgIGlmIChpc0NvbGdyb3VwICYmIGNvbGdyb3Vwcykge1xuICAgICAgICAgICAgY29sZ3JvdXBzLmZvckVhY2goKGNvbHMsIHJJbmRleCkgPT4ge1xuICAgICAgICAgICAgICAgIGNvbnN0IGdyb3VwSGVhZCA9IHt9O1xuICAgICAgICAgICAgICAgIGNvbHVtbnMuZm9yRWFjaCgoY29sdW1uKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGdyb3VwSGVhZFtjb2x1bW4uaWRdID0gbnVsbDtcbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICBjb2xzLmZvckVhY2goKGNvbHVtbikgPT4ge1xuICAgICAgICAgICAgICAgICAgICBjb25zdCB7IF9jb2xTcGFuLCBfcm93U3BhbiwgaGVhZGVyRXhwb3J0TWV0aG9kIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHZhbGlkQ29sdW1uID0gZ2V0VmFsaWRDb2x1bW4oY29sdW1uKTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgY29sdW1uSW5kZXggPSBjb2x1bW5zLmluZGV4T2YodmFsaWRDb2x1bW4pO1xuICAgICAgICAgICAgICAgICAgICBncm91cEhlYWRbdmFsaWRDb2x1bW4uaWRdID0gaGVhZGVyRXhwb3J0TWV0aG9kID8gaGVhZGVyRXhwb3J0TWV0aG9kKHsgY29sdW1uLCAkdGFibGUgfSkgOiAob3JpZ2luYWwgPyB2YWxpZENvbHVtbi5maWVsZCA6IGNvbHVtbi5nZXRUaXRsZSgpKTtcbiAgICAgICAgICAgICAgICAgICAgaWYgKF9jb2xTcGFuID4gMSB8fCBfcm93U3BhbiA+IDEpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHM6IHsgcjogckluZGV4LCBjOiBjb2x1bW5JbmRleCB9LFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGU6IHsgcjogckluZGV4ICsgX3Jvd1NwYW4gLSAxLCBjOiBjb2x1bW5JbmRleCArIF9jb2xTcGFuIC0gMSB9XG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgIGNvbExpc3QucHVzaChncm91cEhlYWQpO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb2xMaXN0LnB1c2goY29sSGVhZCk7XG4gICAgICAgIH1cbiAgICAgICAgYmVmb3JlUm93Q291bnQgKz0gY29sTGlzdC5sZW5ndGg7XG4gICAgfVxuICAgIC8vIOWkhOeQhuWQiOW5tlxuICAgIGlmIChpc01lcmdlKSB7XG4gICAgICAgIG1lcmdlQ2VsbHMuZm9yRWFjaChtZXJnZUl0ZW0gPT4ge1xuICAgICAgICAgICAgY29uc3QgeyByb3c6IG1lcmdlUm93SW5kZXgsIHJvd3NwYW46IG1lcmdlUm93c3BhbiwgY29sOiBtZXJnZUNvbEluZGV4LCBjb2xzcGFuOiBtZXJnZUNvbHNwYW4gfSA9IG1lcmdlSXRlbTtcbiAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgIHM6IHsgcjogbWVyZ2VSb3dJbmRleCArIGJlZm9yZVJvd0NvdW50LCBjOiBtZXJnZUNvbEluZGV4IH0sXG4gICAgICAgICAgICAgICAgZTogeyByOiBtZXJnZVJvd0luZGV4ICsgYmVmb3JlUm93Q291bnQgKyBtZXJnZVJvd3NwYW4gLSAxLCBjOiBtZXJnZUNvbEluZGV4ICsgbWVyZ2VDb2xzcGFuIC0gMSB9XG4gICAgICAgICAgICB9KTtcbiAgICAgICAgfSk7XG4gICAgfVxuICAgIGNvbnN0IHJvd0xpc3QgPSBkYXRhcy5tYXAoaXRlbSA9PiB7XG4gICAgICAgIGNvbnN0IHJlc3QgPSB7fTtcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgIHJlc3RbY29sdW1uLmlkXSA9IGdldENlbGxMYWJlbChjb2x1bW4sIGl0ZW1bY29sdW1uLmlkXSk7XG4gICAgICAgIH0pO1xuICAgICAgICByZXR1cm4gcmVzdDtcbiAgICB9KTtcbiAgICBiZWZvcmVSb3dDb3VudCArPSByb3dMaXN0Lmxlbmd0aDtcbiAgICAvLyDlpITnkIbooajlsL5cbiAgICBpZiAoaXNGb290ZXIpIHtcbiAgICAgICAgY29uc3QgeyBmb290ZXJEYXRhIH0gPSAkdGFibGUuZ2V0VGFibGVEYXRhKCk7XG4gICAgICAgIGNvbnN0IGZvb3RlcnMgPSBnZXRGb290ZXJEYXRhKG9wdGlvbnMsIGZvb3RlckRhdGEpO1xuICAgICAgICBjb25zdCBtZXJnZUZvb3Rlckl0ZW1zID0gJHRhYmxlLmdldE1lcmdlRm9vdGVySXRlbXMoKTtcbiAgICAgICAgLy8g5aSE55CG5ZCI5bm2XG4gICAgICAgIGlmIChpc01lcmdlKSB7XG4gICAgICAgICAgICBtZXJnZUZvb3Rlckl0ZW1zLmZvckVhY2gobWVyZ2VJdGVtID0+IHtcbiAgICAgICAgICAgICAgICBjb25zdCB7IHJvdzogbWVyZ2VSb3dJbmRleCwgcm93c3BhbjogbWVyZ2VSb3dzcGFuLCBjb2w6IG1lcmdlQ29sSW5kZXgsIGNvbHNwYW46IG1lcmdlQ29sc3BhbiB9ID0gbWVyZ2VJdGVtO1xuICAgICAgICAgICAgICAgIHNoZWV0TWVyZ2VzLnB1c2goe1xuICAgICAgICAgICAgICAgICAgICBzOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCwgYzogbWVyZ2VDb2xJbmRleCB9LFxuICAgICAgICAgICAgICAgICAgICBlOiB7IHI6IG1lcmdlUm93SW5kZXggKyBiZWZvcmVSb3dDb3VudCArIG1lcmdlUm93c3BhbiAtIDEsIGM6IG1lcmdlQ29sSW5kZXggKyBtZXJnZUNvbHNwYW4gLSAxIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGZvb3RlcnMuZm9yRWFjaCgocm93cykgPT4ge1xuICAgICAgICAgICAgY29uc3QgaXRlbSA9IHt9O1xuICAgICAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgICAgICBpdGVtW2NvbHVtbi5pZF0gPSBnZXRGb290ZXJDZWxsVmFsdWUoJHRhYmxlLCBvcHRpb25zLCByb3dzLCBjb2x1bW4pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICBmb290TGlzdC5wdXNoKGl0ZW0pO1xuICAgICAgICB9KTtcbiAgICB9XG4gICAgY29uc3QgZXhwb3J0TWV0aG9kID0gKCkgPT4ge1xuICAgICAgICBjb25zdCB3b3JrYm9vayA9IG5ldyBFeGNlbEpTLldvcmtib29rKCk7XG4gICAgICAgIGNvbnN0IHNoZWV0ID0gd29ya2Jvb2suYWRkV29ya3NoZWV0KHNoZWV0TmFtZSk7XG4gICAgICAgIHdvcmtib29rLmNyZWF0b3IgPSAndnhlLXRhYmxlJztcbiAgICAgICAgc2hlZXQuY29sdW1ucyA9IHNoZWV0Q29scztcbiAgICAgICAgaWYgKGlzSGVhZGVyKSB7XG4gICAgICAgICAgICBzaGVldC5hZGRSb3dzKGNvbExpc3QpLmZvckVhY2goZXhjZWxSb3cgPT4ge1xuICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgZXhjZWxSb3cuZWFjaENlbGwoZXhjZWxDZWxsID0+IHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGNvbHVtbiA9ICR0YWJsZS5nZXRDb2x1bW5CeUlkKGV4Y2VsQ29sLmtleSk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgaGVhZGVyQWxpZ24sIGFsaWduIH0gPSBjb2x1bW47XG4gICAgICAgICAgICAgICAgICAgIHNldEV4Y2VsQ2VsbFN0eWxlKGV4Y2VsQ2VsbCwgaGVhZGVyQWxpZ24gfHwgYWxpZ24gfHwgYWxsSGVhZGVyQWxpZ24gfHwgYWxsQWxpZ24pO1xuICAgICAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgIE9iamVjdC5hc3NpZ24oZXhjZWxDZWxsLCB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZm9udDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBib2xkOiB0cnVlLFxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgYXJnYjogZGVmYXVsdENlbGxGb250Q29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgZmlsbDoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB0eXBlOiAncGF0dGVybicsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIHBhdHRlcm46ICdzb2xpZCcsXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGZnQ29sb3I6IHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRIZWFkZXJCYWNrZ3JvdW5kQ29sb3JcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgYm9yZGVyOiBnZXREZWZhdWx0Qm9yZGVyU3R5bGUoKVxuICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIHNoZWV0LmFkZFJvd3Mocm93TGlzdCkuZm9yRWFjaChleGNlbFJvdyA9PiB7XG4gICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICBzZXRFeGNlbFJvd0hlaWdodChleGNlbFJvdywgcm93SGVpZ2h0KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZXhjZWxDb2wgPSBzaGVldC5nZXRDb2x1bW4oZXhjZWxDZWxsLmNvbCk7XG4gICAgICAgICAgICAgICAgY29uc3QgY29sdW1uID0gJHRhYmxlLmdldENvbHVtbkJ5SWQoZXhjZWxDb2wua2V5KTtcbiAgICAgICAgICAgICAgICBpZiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IHsgYWxpZ24gfSA9IGNvbHVtbjtcbiAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBhbGlnbiB8fCBhbGxBbGlnbik7XG4gICAgICAgICAgICAgICAgICAgIGlmICh1c2VTdHlsZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgT2JqZWN0LmFzc2lnbihleGNlbENlbGwsIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbG9yOiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBhcmdiOiBkZWZhdWx0Q2VsbEZvbnRDb2xvclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSxcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBib3JkZXI6IGdldERlZmF1bHRCb3JkZXJTdHlsZSgpXG4gICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9KTtcbiAgICAgICAgaWYgKGlzRm9vdGVyKSB7XG4gICAgICAgICAgICBzaGVldC5hZGRSb3dzKGZvb3RMaXN0KS5mb3JFYWNoKGV4Y2VsUm93ID0+IHtcbiAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxSb3dIZWlnaHQoZXhjZWxSb3csIHJvd0hlaWdodCk7XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGV4Y2VsUm93LmVhY2hDZWxsKGV4Y2VsQ2VsbCA9PiB7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGV4Y2VsQ29sID0gc2hlZXQuZ2V0Q29sdW1uKGV4Y2VsQ2VsbC5jb2wpO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBjb2x1bW4gPSAkdGFibGUuZ2V0Q29sdW1uQnlJZChleGNlbENvbC5rZXkpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoY29sdW1uKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCB7IGZvb3RlckFsaWduLCBhbGlnbiB9ID0gY29sdW1uO1xuICAgICAgICAgICAgICAgICAgICAgICAgc2V0RXhjZWxDZWxsU3R5bGUoZXhjZWxDZWxsLCBmb290ZXJBbGlnbiB8fCBhbGlnbiB8fCBhbGxGb290ZXJBbGlnbiB8fCBhbGxBbGlnbik7XG4gICAgICAgICAgICAgICAgICAgICAgICBpZiAodXNlU3R5bGUpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBPYmplY3QuYXNzaWduKGV4Y2VsQ2VsbCwge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBmb250OiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBjb2xvcjoge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGFyZ2I6IGRlZmF1bHRDZWxsRm9udENvbG9yXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0sXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGJvcmRlcjogZ2V0RGVmYXVsdEJvcmRlclN0eWxlKClcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgfSk7XG4gICAgICAgIH1cbiAgICAgICAgaWYgKHVzZVN0eWxlICYmIHNoZWV0TWV0aG9kKSB7XG4gICAgICAgICAgICBzaGVldE1ldGhvZCh7IG9wdGlvbnM6IG9wdGlvbnMsIHdvcmtib29rLCB3b3Jrc2hlZXQ6IHNoZWV0LCBjb2x1bW5zLCBjb2xncm91cHMsIGRhdGFzLCAkdGFibGUgfSk7XG4gICAgICAgIH1cbiAgICAgICAgc2hlZXRNZXJnZXMuZm9yRWFjaCgoeyBzLCBlIH0pID0+IHtcbiAgICAgICAgICAgIHNoZWV0Lm1lcmdlQ2VsbHMocy5yICsgMSwgcy5jICsgMSwgZS5yICsgMSwgZS5jICsgMSk7XG4gICAgICAgIH0pO1xuICAgICAgICB3b3JrYm9vay54bHN4LndyaXRlQnVmZmVyKCkudGhlbihidWZmZXIgPT4ge1xuICAgICAgICAgICAgY29uc3QgYmxvYiA9IG5ldyBCbG9iKFtidWZmZXJdLCB7IHR5cGU6ICdhcHBsaWNhdGlvbi9vY3RldC1zdHJlYW0nIH0pO1xuICAgICAgICAgICAgLy8g5a+85Ye6IHhsc3hcbiAgICAgICAgICAgIGRvd25sb2FkRmlsZShwYXJhbXMsIGJsb2IsIG9wdGlvbnMpO1xuICAgICAgICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcbiAgICAgICAgICAgICAgICBtb2RhbC5jbG9zZShtc2dLZXkpO1xuICAgICAgICAgICAgICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUudGFibGUuZXhwU3VjY2VzcycpLCBzdGF0dXM6ICdzdWNjZXNzJyB9KTtcbiAgICAgICAgICAgIH1cbiAgICAgICAgfSk7XG4gICAgfTtcbiAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xuICAgICAgICBtb2RhbC5tZXNzYWdlKHsgaWQ6IG1zZ0tleSwgY29udGVudDogdCgndnhlLnRhYmxlLmV4cExvYWRpbmcnKSwgc3RhdHVzOiAnbG9hZGluZycsIGR1cmF0aW9uOiAtMSB9KTtcbiAgICAgICAgc2V0VGltZW91dChleHBvcnRNZXRob2QsIDE1MDApO1xuICAgIH1cbiAgICBlbHNlIHtcbiAgICAgICAgZXhwb3J0TWV0aG9kKCk7XG4gICAgfVxufVxuZnVuY3Rpb24gZG93bmxvYWRGaWxlKHBhcmFtcywgYmxvYiwgb3B0aW9ucykge1xuICAgIGNvbnN0IHsgbW9kYWwsIHQgfSA9IHZ4ZXRhYmxlO1xuICAgIGNvbnN0IHsgbWVzc2FnZSwgZmlsZW5hbWUsIHR5cGUgfSA9IG9wdGlvbnM7XG4gICAgY29uc3Qgc2hvd01zZyA9IG1lc3NhZ2UgIT09IGZhbHNlO1xuICAgIGlmICh3aW5kb3cuQmxvYikge1xuICAgICAgICBpZiAobmF2aWdhdG9yLm1zU2F2ZUJsb2IpIHtcbiAgICAgICAgICAgIG5hdmlnYXRvci5tc1NhdmVCbG9iKGJsb2IsIGAke2ZpbGVuYW1lfS4ke3R5cGV9YCk7XG4gICAgICAgIH1cbiAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICBjb25zdCBsaW5rRWxlbSA9IGRvY3VtZW50LmNyZWF0ZUVsZW1lbnQoJ2EnKTtcbiAgICAgICAgICAgIGxpbmtFbGVtLnRhcmdldCA9ICdfYmxhbmsnO1xuICAgICAgICAgICAgbGlua0VsZW0uZG93bmxvYWQgPSBgJHtmaWxlbmFtZX0uJHt0eXBlfWA7XG4gICAgICAgICAgICBsaW5rRWxlbS5ocmVmID0gVVJMLmNyZWF0ZU9iamVjdFVSTChibG9iKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkuYXBwZW5kQ2hpbGQobGlua0VsZW0pO1xuICAgICAgICAgICAgbGlua0VsZW0uY2xpY2soKTtcbiAgICAgICAgICAgIGRvY3VtZW50LmJvZHkucmVtb3ZlQ2hpbGQobGlua0VsZW0pO1xuICAgICAgICB9XG4gICAgfVxuICAgIGVsc2Uge1xuICAgICAgICBpZiAoc2hvd01zZyAmJiBtb2RhbCkge1xuICAgICAgICAgICAgbW9kYWwuYWxlcnQoeyBjb250ZW50OiB0KCd2eGUuZXJyb3Iubm90RXhwJyksIHN0YXR1czogJ2Vycm9yJyB9KTtcbiAgICAgICAgfVxuICAgIH1cbn1cbmZ1bmN0aW9uIGNoZWNrSW1wb3J0RGF0YSh0YWJsZUZpZWxkcywgZmllbGRzKSB7XG4gICAgcmV0dXJuIGZpZWxkcy5zb21lKGZpZWxkID0+IHRhYmxlRmllbGRzLmluZGV4T2YoZmllbGQpID4gLTEpO1xufVxuZnVuY3Rpb24gaW1wb3J0RXJyb3IocGFyYW1zKSB7XG4gICAgY29uc3QgeyBtb2RhbCwgdCB9ID0gdnhldGFibGU7XG4gICAgY29uc3QgeyAkdGFibGUsIG9wdGlvbnMgfSA9IHBhcmFtcztcbiAgICBjb25zdCB7IGludGVybmFsRGF0YSB9ID0gJHRhYmxlO1xuICAgIGNvbnN0IHsgX2ltcG9ydFJlamVjdCB9ID0gaW50ZXJuYWxEYXRhO1xuICAgIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlO1xuICAgIGlmIChzaG93TXNnICYmIG1vZGFsKSB7XG4gICAgICAgIG1vZGFsLm1lc3NhZ2UoeyBjb250ZW50OiB0KCd2eGUuZXJyb3IuaW1wRmllbGRzJyksIHN0YXR1czogJ2Vycm9yJyB9KTtcbiAgICB9XG4gICAgaWYgKF9pbXBvcnRSZWplY3QpIHtcbiAgICAgICAgX2ltcG9ydFJlamVjdCh7IHN0YXR1czogZmFsc2UgfSk7XG4gICAgfVxufVxuZnVuY3Rpb24gaW1wb3J0WExTWChwYXJhbXMpIHtcbiAgICBjb25zdCB7IG1vZGFsLCB0IH0gPSB2eGV0YWJsZTtcbiAgICBjb25zdCB7ICR0YWJsZSwgY29sdW1ucywgb3B0aW9ucywgZmlsZSB9ID0gcGFyYW1zO1xuICAgIGNvbnN0IHsgaW50ZXJuYWxEYXRhIH0gPSAkdGFibGU7XG4gICAgY29uc3QgeyBfaW1wb3J0UmVzb2x2ZSB9ID0gaW50ZXJuYWxEYXRhO1xuICAgIGNvbnN0IHNob3dNc2cgPSBvcHRpb25zLm1lc3NhZ2UgIT09IGZhbHNlO1xuICAgIGNvbnN0IGZpbGVSZWFkZXIgPSBuZXcgRmlsZVJlYWRlcigpO1xuICAgIGZpbGVSZWFkZXIub25lcnJvciA9ICgpID0+IHtcbiAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKTtcbiAgICB9O1xuICAgIGZpbGVSZWFkZXIub25sb2FkID0gKGV2bnQpID0+IHtcbiAgICAgICAgY29uc3QgdGFibGVGaWVsZHMgPSBbXTtcbiAgICAgICAgY29sdW1ucy5mb3JFYWNoKChjb2x1bW4pID0+IHtcbiAgICAgICAgICAgIGNvbnN0IGZpZWxkID0gY29sdW1uLmZpZWxkO1xuICAgICAgICAgICAgaWYgKGZpZWxkKSB7XG4gICAgICAgICAgICAgICAgdGFibGVGaWVsZHMucHVzaChmaWVsZCk7XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBjb25zdCB3b3JrYm9vayA9IG5ldyBFeGNlbEpTLldvcmtib29rKCk7XG4gICAgICAgIGNvbnN0IHJlYWRlclRhcmdldCA9IGV2bnQudGFyZ2V0O1xuICAgICAgICBpZiAocmVhZGVyVGFyZ2V0KSB7XG4gICAgICAgICAgICB3b3JrYm9vay54bHN4LmxvYWQocmVhZGVyVGFyZ2V0LnJlc3VsdCkudGhlbih3YiA9PiB7XG4gICAgICAgICAgICAgICAgY29uc3QgZmlyc3RTaGVldCA9IHdiLndvcmtzaGVldHNbMF07XG4gICAgICAgICAgICAgICAgaWYgKGZpcnN0U2hlZXQpIHtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc2hlZXRWYWx1ZXMgPSBmaXJzdFNoZWV0LmdldFNoZWV0VmFsdWVzKCk7XG4gICAgICAgICAgICAgICAgICAgIGNvbnN0IGZpZWxkSW5kZXggPSBYRVV0aWxzLmZpbmRJbmRleE9mKHNoZWV0VmFsdWVzLCAobGlzdCkgPT4gbGlzdCAmJiBsaXN0Lmxlbmd0aCA+IDApO1xuICAgICAgICAgICAgICAgICAgICBjb25zdCBmaWVsZHMgPSBzaGVldFZhbHVlc1tmaWVsZEluZGV4XTtcbiAgICAgICAgICAgICAgICAgICAgY29uc3Qgc3RhdHVzID0gY2hlY2tJbXBvcnREYXRhKHRhYmxlRmllbGRzLCBmaWVsZHMpO1xuICAgICAgICAgICAgICAgICAgICBpZiAoc3RhdHVzKSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBjb25zdCByZWNvcmRzID0gc2hlZXRWYWx1ZXMuc2xpY2UoZmllbGRJbmRleCkubWFwKGxpc3QgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IGl0ZW0gPSB7fTtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBsaXN0LmZvckVhY2goKGNlbGxWYWx1ZSwgY0luZGV4KSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGl0ZW1bZmllbGRzW2NJbmRleF1dID0gY2VsbFZhbHVlO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGNvbnN0IHJlY29yZCA9IHt9O1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHRhYmxlRmllbGRzLmZvckVhY2goZmllbGQgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICByZWNvcmRbZmllbGRdID0gWEVVdGlscy5pc1VuZGVmaW5lZChpdGVtW2ZpZWxkXSkgPyBudWxsIDogaXRlbVtmaWVsZF07XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgcmV0dXJuIHJlY29yZDtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgJHRhYmxlLmNyZWF0ZURhdGEocmVjb3JkcylcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICAudGhlbigoZGF0YSkgPT4ge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGxldCBsb2FkUmVzdDtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBpZiAob3B0aW9ucy5tb2RlID09PSAnaW5zZXJ0Jykge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUmVzdCA9ICR0YWJsZS5pbnNlcnRBdChkYXRhLCAtMSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICBsb2FkUmVzdCA9ICR0YWJsZS5yZWxvYWREYXRhKGRhdGEpO1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICByZXR1cm4gbG9hZFJlc3QudGhlbigoKSA9PiB7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIGlmIChfaW1wb3J0UmVzb2x2ZSkge1xuICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgX2ltcG9ydFJlc29sdmUoeyBzdGF0dXM6IHRydWUgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB9KTtcbiAgICAgICAgICAgICAgICAgICAgICAgIH0pO1xuICAgICAgICAgICAgICAgICAgICAgICAgaWYgKHNob3dNc2cgJiYgbW9kYWwpIHtcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBtb2RhbC5tZXNzYWdlKHsgY29udGVudDogdCgndnhlLnRhYmxlLmltcFN1Y2Nlc3MnLCBbcmVjb3Jkcy5sZW5ndGhdKSwgc3RhdHVzOiAnc3VjY2VzcycgfSk7XG4gICAgICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgICAgICAgICAgZWxzZSB7XG4gICAgICAgICAgICAgICAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpO1xuICAgICAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICAgICAgfVxuICAgICAgICAgICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgICAgICAgICBpbXBvcnRFcnJvcihwYXJhbXMpO1xuICAgICAgICAgICAgICAgIH1cbiAgICAgICAgICAgIH0pO1xuICAgICAgICB9XG4gICAgICAgIGVsc2Uge1xuICAgICAgICAgICAgaW1wb3J0RXJyb3IocGFyYW1zKTtcbiAgICAgICAgfVxuICAgIH07XG4gICAgZmlsZVJlYWRlci5yZWFkQXNBcnJheUJ1ZmZlcihmaWxlKTtcbn1cbmZ1bmN0aW9uIGhhbmRsZUltcG9ydEV2ZW50KHBhcmFtcykge1xuICAgIGlmIChwYXJhbXMub3B0aW9ucy50eXBlID09PSAneGxzeCcpIHtcbiAgICAgICAgaW1wb3J0WExTWChwYXJhbXMpO1xuICAgICAgICByZXR1cm4gZmFsc2U7XG4gICAgfVxufVxuZnVuY3Rpb24gaGFuZGxlRXhwb3J0RXZlbnQocGFyYW1zKSB7XG4gICAgaWYgKHBhcmFtcy5vcHRpb25zLnR5cGUgPT09ICd4bHN4Jykge1xuICAgICAgICBleHBvcnRYTFNYKHBhcmFtcyk7XG4gICAgICAgIHJldHVybiBmYWxzZTtcbiAgICB9XG59XG4vKipcbiAqIOWfuuS6jiB2eGUtdGFibGUg6KGo5qC855qE5aKe5by65o+S5Lu277yM5pSv5oyB5a+85Ye6IHhsc3gg5qC85byPXG4gKi9cbmV4cG9ydCBjb25zdCBWWEVUYWJsZVBsdWdpbkV4cG9ydFhMU1ggPSB7XG4gICAgaW5zdGFsbCh2eGV0YWJsZWNvcmUpIHtcbiAgICAgICAgY29uc3QgeyBzZXR1cCwgaW50ZXJjZXB0b3IgfSA9IHZ4ZXRhYmxlY29yZTtcbiAgICAgICAgdnhldGFibGUgPSB2eGV0YWJsZWNvcmU7XG4gICAgICAgIHNldHVwKHtcbiAgICAgICAgICAgIGV4cG9ydDoge1xuICAgICAgICAgICAgICAgIHR5cGVzOiB7XG4gICAgICAgICAgICAgICAgICAgIHhsc3g6IDBcbiAgICAgICAgICAgICAgICB9XG4gICAgICAgICAgICB9XG4gICAgICAgIH0pO1xuICAgICAgICBpbnRlcmNlcHRvci5taXhpbih7XG4gICAgICAgICAgICAnZXZlbnQuaW1wb3J0JzogaGFuZGxlSW1wb3J0RXZlbnQsXG4gICAgICAgICAgICAnZXZlbnQuZXhwb3J0JzogaGFuZGxlRXhwb3J0RXZlbnRcbiAgICAgICAgfSk7XG4gICAgfVxufTtcbmlmICh0eXBlb2Ygd2luZG93ICE9PSAndW5kZWZpbmVkJyAmJiB3aW5kb3cuVlhFVGFibGUgJiYgd2luZG93LlZYRVRhYmxlLnVzZSkge1xuICAgIHdpbmRvdy5WWEVUYWJsZS51c2UoVlhFVGFibGVQbHVnaW5FeHBvcnRYTFNYKTtcbn1cbmV4cG9ydCBkZWZhdWx0IFZYRVRhYmxlUGx1Z2luRXhwb3J0WExTWDtcbiJdfQ==
